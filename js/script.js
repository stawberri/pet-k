(function(){var i=this;this.puddi=function(u){return i.puddi.mew.push(u)},this.puddi.mew=[],puddi(function(u){i._=u})}).call(this);
(function(){var i="".split,n=[].join;puddi(function(){var t;return t=createjs.Sound,this._registerSound=function(u,d){var o;return o=i.call(u,"."),o.pop(),o=n.call(o,"."),t.registerSound(u,o,void 0,"snd/",d)},this._playSound=function(i){return t.loadComplete(i)?t.play(i):void 0}})}).call(this);
(function(){puddi(function(){function t(t){var n=this;Object.defineProperty(this,"$"+t,{get:function(){return function(t){return null!=t?t:0}(n.$.get(t))},set:function(e){var i;i=parseInt(e,10),isNaN(i)?n.$.del(t):n.$.set(t,i)},configurable:!0,enumerable:!0})}function n(t){var n=this;return Object.defineProperty(this,"$"+t,{get:function(){return n.$.get(t)},set:function(e){null!=e?n.$.set(t,e):n.$.del(t)},configurable:!0,enumerable:!0}),this}var e,i,r,u=[];for(this.$=new Barn(localStorage),e=0,r=(i=["xp","lv","hp","xpTime","overloadTime","lv","mp","recoverTime"]).length;r>e;++e)t.call(this,i[e]);for(e=0,r=(i=["xpPassing"]).length;r>e;++e)u.push(n.call(this,i[e]));return u})}).call(this);
(function(){function n(n,t){var e={}.hasOwnProperty;for(var i in t)e.call(t,i)&&(n[i]=t[i]);return n}function t(n){function t(){}return t.prototype=n,new t}puddi(function(){var e,i,r,u,o,l,a,s;for(e=[{xpMin:500,xpPass:1e3,xpMax:3e3,hpGoal:3e3,overloadWait:1e3,cooldown:1e3}],u=[],o=0,l=e.length;l>o;++o)a=o,s=e[o],u.push(i=0===a?s:n(t(i),s));return r=u,this.lv=function(n){return null==n&&(n=this.$lv),r[n]},null==this.lv()?this.$lv=r.length-1:void 0})}).call(this);
(function(){puddi(function(){var t,n,e=this;return this.stage=new createjs.Stage("game"),createjs.Touch.enable(this.stage),t=$.Callbacks("memory unique"),this.tick=function(n){return t.add(n)},n=createjs.Ticker,n.framerate=30,n.timingMode=n.RAF_SYNCHED,n.addEventListener("tick",t.fire),this.tick(function(t){return e.stage.update(t)})})}).call(this);
(function(){puddi(function(){var t,e,n,i,r=this;return t=e=new createjs.Container,t.x=480,t.y=270,this.stage.addChild(e),n=i=new createjs.Bitmap("img/bg/city-water.jpg"),n.regX=640,n.regY=360,e.addChild(i),this.tick(function(){var t,e,n,u;return t=r.$xp,t/=r.lv().xpMax,e=.05*-t+1,n=10*t,n=new createjs.BlurFilter(n,n,1),u=i,u.scaleX=e,u.scaleY=e,u.filters=[n],u.cache(0,0,1280,720),u})})}).call(this);
(function(){puddi(function(){var t,e,n,i,r,a,o,u,l=this;return t=e=new createjs.Sprite(new createjs.SpriteSheet({images:["img/k/0.png","img/k/1.png","img/k/2.png"],frames:{width:368,height:492},animations:{idle:0,alert:1,exclaim:{frames:[2,1,2,1],next:"exclaimAfter"},exclaimAfter:2}})),t.x=69,t.y=49,n=!1,r=$(window),r.on("mousedown touchstart",function(){return n=!0}),r.on("mouseup touchend",function(){return n=!1,i=void 0}),a=0,o=this.stage,o.addChild(e),o.addEventListener("stagemousemove",function(t){var r,o,u;return r=$.now(),n&&r>a&&r>l.$overloadTime&&r>l.$recoverTime?(a=$.now()+50,o=e.globalToLocal(t.stageX,t.stageY),o.hit=e.hitTest(o.x,o.y),(null!=i&&i.hit||o.hit)&&null!=i&&(u=Math.pow(Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2),.5),u=Math.ceil(u),l.$xp+=u),i=o):void 0}),u="idle",this.tick(function(t){var n;switch(n=t.timeStamp,u){case"idle":if(l.$xpPassing&&e.gotoAndPlay(u="exclaim"),!(n>l.$recoverTime))return e.gotoAndStop(u="alert");break;case"exclaim":if(l.$xpPassing||e.gotoAndStop(u="idle"),!(n>l.$recoverTime))return e.gotoAndStop(u="alert");break;case"alert":if(n>l.$recoverTime)return e.gotoAndStop(u="idle")}})})}).call(this);
(function(){puddi(function(){var e,t=this;return this._registerSound("xp-fail.mp3",{volume:.3}),this._registerSound("xp-pass.mp3",{volume:.5}),this._registerSound("xp-overload.mp3"),this._registerSound("mp-up.mp3",{volume:.5}),this._registerSound("lv-up.mp3",{volume:.5}),e=function(e,i){switch(null==e&&(e=t.$xp),null==i&&(i=t.lv()),!1){case!(e<i.xpMin):return-1;case!(e<i.xpPass):return 0;case!(e<i.xpMax):return 1;default:return 2}},this.hpGoal=function(){return Math.ceil((1+t.$mp/69)*t.lv().hpGoal)},this.tick(function(i){var n,r;if(n=i.timeStamp-t.$xpTime,n=Math.floor(n),!(1>n)){switch(t.$xp-=n,t.$xp>=0||(t.$xp=0),t.$xpTime=i.timeStamp,r=t.lv(),e(t.$xp,r)){case-1:t.$xpPassing&&(t._playSound("xp-fail"),t.$xpPassing=!1);break;case 0:break;case 1:t.$xpPassing||(t._playSound("xp-pass"),t.$xpPassing=!0);break;case 2:i.timeStamp>t.$overloadTime&&(t._playSound("xp-overload"),t.$xpPassing=!1,t.$overloadTime=i.timeStamp+r.overloadWait*(1+t.$mp/69),t.$xp=0,t.$hp=0)}return t.$xpPassing?t.$hp+=Math.ceil((t.$xp-r.xpMin)*n/(r.xpMax-r.xpMin)):(t.$hp-=Math.ceil((r.xpPass-t.$xp)*n/(r.xpMax-r.xpMin)),t.$hp>=0||(t.$hp=0)),t.$hp>=t.hpGoal()?(t.$xpPassing=!1,t.$xp=0,t.$hp=0,t.$overloadTime=0,function(e){return null!=e}(t.lv(t.$lv+1))?(t._playSound("lv-up"),t.$mp=0,t.$lv++):(t._playSound("mp-up"),t.$mp++),t.$recoverTime=i.timeStamp+t.lv().cooldown*(1+t.$mp/69)):void 0}})})}).call(this);
(function(){puddi(function(){var e,t,i,n,a,r,o,s,l,p,u,c,d=this;return e=t=new createjs.Container,e.x=700,e.y=380,i=(n=new createjs.Shape).graphics,i.setStrokeStyle(5),i.beginStroke("rgba(32, 32, 32, 1)"),i.beginFill("rgba(32, 32, 32, 0.5)"),i.drawCircle(0,0,120),a=(r=new createjs.Shape).graphics,a.setStrokeStyle(3),o=a.beginStroke("rgba(128, 128, 128, 1)").command,s=a.beginFill("transparent").command,l=a.drawCircle(0,0,0).command,p=new createjs.Shape,u=c=new createjs.Container,u.visible=!1,u.addChild(p),u.addChild(n),u.addChild(r),t.addChild(c),this.stage.addChild(t),this.tick(function(e){var t,i,a,r,o;return t=e.timeStamp,t>d.$overloadTime&&t>d.$recoverTime?(c.visible||(i=createjs.Tween.get(c,{override:!0}),i.to({alpha:0,scaleX:.69,scaleY:.69,visible:!0}),i.to({y:0,alpha:1,scaleX:1,scaleY:1},3e3,createjs.Ease.elasticOut)),d.$xpPassing?s.style="rgba(128, 128, 128, 0.8)":s.style="transparent",l.radius=120*d.$xp/d.lv().xpMax,a=240*d.$hp/d.hpGoal(),r=p,o=r.graphics,o.clear(),o.beginFill("rgba(32, 32, 32, 0.8)"),o.rect(-120,120-a,240,a),r.mask=n,r):c.visible=!1})})}).call(this);
(function(){var e,t,i,n,a;for(e={_:this},t=0,a=(n=this.puddi.mew).length;a>t;++t)i=n[t],i.call(e,e)}).call(this);
